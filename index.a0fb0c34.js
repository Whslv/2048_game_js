const e=new class{constructor(e){this.size=4,this.score=0,this.status="idle",this.board=e||this.createEmptyBoard()}createEmptyBoard(){return Array.from({length:this.size},()=>Array(this.size).fill(0))}getScore(){return this.score}getState(){return this.board}getStatus(){return this.status}start(){this.board=this.createEmptyBoard(),this.score=0,this.status="playing",this.addRandomTile(),this.addRandomTile()}restart(){this.start()}addRandomTile(){let e=[];for(let t=0;t<this.size;t++)for(let s=0;s<this.size;s++)0===this.board[t][s]&&e.push([t,s]);if(0===e.length)return;let[t,s]=e[Math.floor(Math.random()*e.length)];this.board[t][s]=.9>Math.random()?2:4,this.lastSpawned={row:t,col:s}}compress(e){let t=e.filter(e=>0!==e);for(;t.length<this.size;)t.push(0);return t}merge(e,t){for(let s=0;s<this.size-1;s++)0!==e[s]&&e[s]===e[s+1]&&(e[s]*=2,e[s]>this.score&&(this.score=e[s]),e[s+1]=0,this.mergedPositions||(this.mergedPositions=[]),this.mergedPositions.push(t(s)));return e}operate(e,t){let s=this.compress(e);return s=this.merge(s,t),s=this.compress(s)}moveLeft(){let e=!1;for(let t=0;t<this.size;t++){let s=this.operate(this.board[t],e=>({row:t,col:e}));s.toString()!==this.board[t].toString()&&(e=!0),this.board[t]=s}e&&this.addRandomTile()}moveRight(){let e=!1;for(let t=0;t<this.size;t++){let s=[...this.board[t]].reverse(),i=this.operate(s,e=>({row:t,col:this.size-1-e})).reverse();i.toString()!==this.board[t].toString()&&(e=!0),this.board[t]=i}e&&this.addRandomTile()}moveUp(){let e=!1;for(let t=0;t<this.size;t++){let s=this.board.map(e=>e[t]),i=this.operate(s,e=>({row:e,col:t}));for(let s=0;s<this.size;s++)this.board[s][t]!==i[s]&&(e=!0),this.board[s][t]=i[s]}e&&this.addRandomTile()}moveDown(){let e=!1;for(let t=0;t<this.size;t++){let s=this.board.map(e=>e[t]).reverse(),i=this.operate(s,e=>({row:this.size-1-e,col:t})).reverse();for(let s=0;s<this.size;s++)this.board[s][t]!==i[s]&&(e=!0),this.board[s][t]=i[s]}e&&this.addRandomTile()}isMovePossible(){for(let e=0;e<this.size;e++)for(let t=0;t<this.size;t++)if(0===this.board[e][t]||t<this.size-1&&this.board[e][t]===this.board[e][t+1]||e<this.size-1&&this.board[e][t]===this.board[e+1][t])return!0;return!1}isWin(){2048===this.score&&(this.status="win")}},t=document.querySelector(".button.start"),s=document.querySelector(".game-score"),i=document.querySelectorAll(".field-cell"),r=document.querySelector(".message.message-start"),o=document.querySelector(".message.message-lose"),a=document.querySelector(".message.message-win");function l(){let t=e.getState();s.textContent=e.getScore(),i.forEach((s,i)=>{let r=Math.floor(i/4),o=i%4,a=t[r][o];s.textContent=0===a?"":a,s.className="field-cell",a>0&&(s.className=`field-cell field-cell--${a}`,e.mergedPositions?.some(e=>e.row===r&&e.col===o)&&(s.classList.add("merge"),setTimeout(()=>s.classList.remove("merge"),300)),e.lastSpawned&&e.lastSpawned.row===r&&e.lastSpawned.col===o&&(s.classList.add("spawn"),setTimeout(()=>s.classList.remove("spawn"),300)))}),e.mergedPositions=[],e.lastSpawned=null}t.addEventListener("click",()=>{e.start(),r.classList.add("hidden"),o.classList.add("hidden"),a.classList.add("hidden"),t.textContent="Reset",t.className="button restart",l()}),document.addEventListener("keydown",t=>{if("playing"!==e.getStatus())return;let s=JSON.stringify(e.getState());"ArrowLeft"===t.key&&e.moveLeft(),"ArrowRight"===t.key&&e.moveRight(),"ArrowUp"===t.key&&e.moveUp(),"ArrowDown"===t.key&&e.moveDown(),s===JSON.stringify(e.getState())||(l(),e.isMovePossible()||(e.status="lose",o.classList.remove("hidden"))),2048===e.score&&(e.status="win",a.classList.remove("hidden"))});
//# sourceMappingURL=index.a0fb0c34.js.map
